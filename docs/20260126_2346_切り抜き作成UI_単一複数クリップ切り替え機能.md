# 切り抜き作成UI: 単一/複数クリップ切り替え機能

## 目的

ユーザーが切り抜き作成時に「意図せず複数のクリップが生成される」という混乱を解消するため。

現状、テキストエリアに複数の箇所を記載すると複数クリップが生成されるが、これがユーザーの意図通りかどうかが不明確。トグルスイッチで明示的に選択させることで、ユーザーの意図を正しく反映した切り抜き処理が行われるようにする。

## 現状

**対象ファイル**: [video-detail-client.tsx](../apps/webapp/src/app/videos/[id]/video-detail-client.tsx#L228-L295)

現在の切り抜き作成UIは以下の構成:
- CardTitle: 「切り抜き作成」
- CardDescription: 「文字起こしを元に、切り抜きたい箇所を指示してください。」
- テキストエリア（clipInstructions）
- 「切り抜きを作成」ボタン

ユーザーが複数箇所を指示した場合、自動的に複数クリップが生成されるが、これが意図的かどうかの確認がない。

## 設計

### UI変更

切り抜き作成カード内に、テキストエリアの前にトグルスイッチを追加する。

```
┌─────────────────────────────────────────────────────┐
│ ✂ 切り抜き作成                                       │
│   文字起こしを元に、切り抜きたい箇所を指示してください。    │
├─────────────────────────────────────────────────────┤
│                                                     │
│  クリップ数    ○ 単一    ● 複数                      │ ← 新規追加
│                                                     │
│  ⚠ 複数クリップを作成する場合は、AIが各クリップの区切りを │ ← 複数選択時のみ表示
│    判別できるよう、明確に記載してください。              │
│    （例：「1. ○○の部分」「2. △△の部分」）              │
│                                                     │
│  ┌─────────────────────────────────────────────────┐│
│  │ 切り抜き指示                                      ││
│  │ ┌───────────────────────────────────────────┐  ││
│  │ │                                            │  ││
│  │ │ （テキストエリア）                           │  ││
│  │ │                                            │  ││
│  │ └───────────────────────────────────────────┘  ││
│  │ どの箇所を切り抜きたいか、具体的に指示してください。  ││
│  └─────────────────────────────────────────────────┘│
│                                                     │
│                              [切り抜きを作成]         │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 必要なコンポーネント追加

shadcn/uiのSwitchコンポーネントが未導入のため追加が必要。

**追加ファイル**: `apps/webapp/src/components/ui/switch.tsx`

shadcn/uiの標準実装（Radix UI Switch）を使用。

### 状態管理

**追加するstate**:
```typescript
const [multipleClips, setMultipleClips] = useState(false); // デフォルトはfalse（単一）
```

### APIリクエストへの影響

`ExtractClipsRequest` 型を拡張して、単一/複数の指定を含める。

**変更対象**: [apps/shared/types/api.ts](../apps/shared/types/api.ts)

```typescript
export interface ExtractClipsRequest {
  clipInstructions: string;
  multipleClips: boolean; // 追加: true=複数クリップを許可, false=単一クリップのみ
}
```

### バックエンド変更

バックエンドのクリップ抽出処理で、`multipleClips` フラグに応じてAIへのプロンプトを調整する必要がある。

- `multipleClips: false` の場合: 「1つのクリップのみを抽出してください」とプロンプトに追加
- `multipleClips: true` の場合: 現状通り複数クリップの抽出を許可

**変更対象**: バックエンドのクリップ抽出usecase（詳細はバックエンド実装時に特定）

### 注意書きテキスト

複数クリップ選択時に表示する注意書き:

```
複数クリップを作成する場合は、AIが各クリップの区切りを判別できるよう、明確に記載してください。
（例：「1. ○○の部分」「2. △△の部分」）
```

## 影響範囲

### フロントエンド
- [apps/webapp/src/app/videos/[id]/video-detail-client.tsx](../apps/webapp/src/app/videos/[id]/video-detail-client.tsx): トグルUI追加
- `apps/webapp/src/components/ui/switch.tsx`: 新規作成（shadcn/ui Switch）

### 共通型定義
- [apps/shared/types/api.ts](../apps/shared/types/api.ts): `ExtractClipsRequest` に `multipleClips` フィールド追加

### バックエンド
- クリップ抽出のusecase/service: プロンプト調整ロジック追加

## 実装ステップ

1. shadcn/uiのSwitchコンポーネントを追加
2. 共通型定義 `ExtractClipsRequest` を拡張
3. フロントエンドUIにトグルスイッチと注意書きを追加
4. バックエンドでmultipleClipsフラグに応じたプロンプト調整を実装
