# 企画書保存バグ修正

## 目的

ユーザーが企画書を編集して保存しようとすると「Content is required」エラーが発生し、保存できない状態を解消するため。

## 問題の詳細

### 現象

- URL: `http://localhost:3000/shorts-gen/{projectId}`
- 操作: 企画書の編集・保存ボタンクリック
- エラー: `ValidationError: Content is required` (HTTP 400)
- ログ:
  ```
  apps/backend dev: [WARNING] [ErrorHandler] Application error {"errorName":"ValidationError","message":"Content is required","statusCode":400}
  apps/backend dev: [WARNING] [RequestLogger] PATCH /api/shorts-gen/projects/{projectId}/planning {"httpRequest":{...,"status":400,...}}
  ```

### 原因

フロントエンド→Next.js Proxy→バックエンド間でリクエストボディのフィールド名が不一致:

1. **フロントエンド** (`planning-block-editor.tsx:50`)
   - 送信: `{ content: currentContent }`

2. **Next.js Proxy** (`apps/webapp/src/app/api/shorts-gen/projects/[projectId]/planning/[planningId]/route.ts:29`)
   - 期待: `body.markdownContent`
   - 実際: `body.content` が来る → `markdownContent` は `undefined`
   - バックエンドへ送信: `{ content: undefined }`

3. **バックエンド** (`planning.routes.ts:256`)
   - バリデーション: `if (!body.content || body.content.trim().length === 0)`
   - 結果: `undefined` なので `ValidationError` をthrow

## 修正方針

Next.js Proxy層の `route.ts:29` で、正しいフィールド名 `body.content` を参照するように修正する。

### 修正箇所

**ファイル**: `apps/webapp/src/app/api/shorts-gen/projects/[projectId]/planning/[planningId]/route.ts`

**変更前**:
```typescript
body: JSON.stringify({
  content: body.markdownContent,  // ← undefined
}),
```

**変更後**:
```typescript
body: JSON.stringify({
  content: body.content,  // ← 正しいフィールド名
}),
```

## 影響範囲

- **修正対象**: Next.js Proxy層の1ファイル、1行のみ
- **影響コンポーネント**: 企画書保存機能のみ
- **破壊的変更**: なし（バグ修正）
- **テスト必要箇所**:
  - 企画書の編集→保存が成功すること
  - 保存後にバージョン番号が更新されること
  - 保存後の内容が正しく表示されること

## 検証手順

1. `http://localhost:3000/shorts-gen/{projectId}` にアクセス
2. 企画書ステップを展開
3. 企画書の内容を編集
4. 保存ボタンをクリック
5. エラーが発生せず、version番号が増加すること
6. 再読み込み後も編集内容が保持されていること
